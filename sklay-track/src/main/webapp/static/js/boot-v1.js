(function(){function r(a,b,c,e){c&&r(a,c);if(a&&b&&"object"===typeof b)for(var d in b)b.hasOwnProperty(d)&&(!e||void 0===a[d])&&(a[d]=b[d]);return a}function o(a,b,c){if(!a)return!1;var e,d=a.length;for(e=0;e<d;e++)if(!1===b.call(c||a[e],a[e],e,a))return e;return!0}if("undefined"===typeof Atk){"object"!==typeof JSON&&(JSON={});(function(){function a(a){return 10>a?"0"+a:a}function b(a){d.lastIndex=0;return d.test(a)?'"'+a.replace(d,function(a){var b=i[a];return"string"===typeof b?b:"\\u"+("0000"+
a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function c(a,e){var d,m,k,i,p=g,j,h=e[a];h&&("object"===typeof h&&"function"===typeof h.toJSON)&&(h=h.toJSON(a));"function"===typeof l&&(h=l.call(e,a,h));switch(typeof h){case "string":return b(h);case "number":return isFinite(h)?String(h):"null";case "boolean":case "null":return String(h);case "object":if(!h)return"null";g+=f;j=[];if("[object Array]"===Object.prototype.toString.apply(h)){i=h.length;for(d=0;d<i;d+=1)j[d]=c(d,h)||"null";k=0===
j.length?"[]":g?"[\n"+g+j.join(",\n"+g)+"\n"+p+"]":"["+j.join(",")+"]";g=p;return k}if(l&&"object"===typeof l){i=l.length;for(d=0;d<i;d+=1)"string"===typeof l[d]&&(m=l[d],(k=c(m,h))&&j.push(b(m)+(g?": ":":")+k))}else for(m in h)Object.prototype.hasOwnProperty.call(h,m)&&(k=c(m,h))&&j.push(b(m)+(g?": ":":")+k);k=0===j.length?"{}":g?"{\n"+g+j.join(",\n"+g)+"\n"+p+"}":"{"+j.join(",")+"}";g=p;return k}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?
this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var e=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
g,f,i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},l;"function"!==typeof JSON.stringify&&(JSON.stringify=function(a,b,d){var e;f=g="";if("number"===typeof d)for(e=0;e<d;e+=1)f+=" ";else"string"===typeof d&&(f=d);if((l=b)&&"function"!==typeof b&&("object"!==typeof b||"number"!==typeof b.length))throw Error("JSON.stringify");return c("",{"":a})});"function"!==typeof JSON.parse&&(JSON.parse=function(a,b){function c(a,d){var e,g,f=a[d];if(f&&"object"===typeof f)for(e in f)Object.prototype.hasOwnProperty.call(f,
e)&&(g=c(f,e),void 0!==g?f[e]=g:delete f[e]);return b.call(a,d,f)}var d;a=String(a);e.lastIndex=0;e.test(a)&&(a=a.replace(e,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof b?c({"":d},""):d;throw new SyntaxError("JSON.parse");})})();var u,
v=void 0,w=function(a){for(s=1;a=t.shift();)a()},t=[],q,i=document,x=i.documentElement,n=x.doScroll,s=/^loade|c/.test(i.readyState);i.addEventListener&&i.addEventListener("DOMContentLoaded",q=function(){i.removeEventListener("DOMContentLoaded",q,!1);w()},!1);n&&i.attachEvent("onreadystatechange",q=function(){/^c/.test(i.readyState)&&(i.detachEvent("onreadystatechange",q),w())});u=v=n?function(a){if(self!=top)s?a():t.push(a);else a:{try{x.doScroll("left")}catch(b){setTimeout(function(){v(a)},50);break a}a()}}:
function(a){s?a():t.push(a)};Atk=function(a){this._cfs=a||{};this._customs={};this._actions=[];this._errors=[]};n=navigator.userAgent;Atk.prototype={_UA:navigator.userAgent,_CHARS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),_EVENTS:{BEGIN:0,END:1,HEARTBEAT:2},_ACTIONS:{CLICK:0,INNNER_CLICK:1,OUTER_CLICK:2,INPUT:3,AJAX:4,CUSTOM:100},_BROWSER:{opera:/opera/i.test(n),msie:/msie/i.test(n)&&!/opera/i.test(n)},uuid:function(a){var b=[];a=a||12;for(var c=0;c<a;c++)b.push(this._CHARS[Math.floor(64*
Math.random())]);return b.join("")},log:function(a,b){if(this._cfs.debug){"object"===typeof a&&(a=JSON.stringify(a));b&&(a=b+": "+a);var c=new Date,c=c.getHours()+":"+c.getMinutes()+":"+c.getSeconds()+"."+c.getMilliseconds();void 0!==window.console&&console.log&&console.log(c+" | "+a)}},getTime:function(){return(new Date).getTime()},getCookie:function(a){var b;if(a=document.cookie.match("(?:^| )"+a+"(?:(?:\x3d([^;]*))|;|$)"))b=a[1]?decodeURIComponent(a[1]):"";return b},setCookie:function(a,b,c,e,
d,g){b=encodeURIComponent(b);var f=c;"number"===typeof f&&(f=new Date,f.setTime(f.getTime()+1E3*c));f instanceof Date&&(b+="; expires\x3d"+f.toUTCString());e&&(b+="; domain\x3d"+e);d&&(b+="; path\x3d"+d);g&&(b+="; secure");b=a+"\x3d"+b;document.cookie=b;this.log(b,"Set cookie")},removeCookie:function(a){this.setCookie(a,"",0)},bindEvent:function(a,b,c){return a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c)},isInDomain:function(a){var b=this._cfs.sDomain;b?0==b.indexOf(".")&&(b=b.substr(1)):
b=window.location.host;a&&b?(b=a.indexOf(b),a=a.indexOf("/",8),a=-1<b&&(b<a||-1==a)):a=!1;return a},setDomainCookie:function(a,b,c,e,d){this.setCookie(a,b,c,this._cfs.sDomain,e,d);this._cfs.sDomain&&this.getCookie(a)!=b&&(this.log("Can not read cookie from "+this._cfs.sDomain+",is session domain incorrect?","Error"),this.setCookie(a,b,c,null,e,d))},trackCustoms:function(a){r(this._customs,a);this.log(a,"Add custom")},trackAction:function(a){if(this._actionCallbacks)for(var b=0,c=this._actionCallbacks.length;b<
c;b++)if(!1===this._actionCallbacks[b](a,a.t))return;10<this._actions.length&&this.send(this._EVENTS.HEARTBEAT);a.s=this.getTime();this._actions.push(a);this.log(a,"Add action")},trackAjax:function(a){var b;b=a.url;b=-1==b.indexOf("http")?location.href.match(/([^?]*\/)/)[1]+b:0==b.indexOf("/")?location.href.match(/(.*\/\/[^/]*)\//)[1]+b:b;a.url=b;a.t=this._ACTIONS.AJAX;this.trackAction(a)},trackEx:function(a){var b;"string"===typeof a?b=a:a.name?b=a.name+": "+a.message:a.message?b=a.message:a.stack?
b=a.stack:a.stacktrace&&(b=a.stacktrace);this._trackError({t:this.getTime(),msg:b})},_trackError:function(a){for(var b=0;b<this._errors.length;b++)if(this._errors[b].msg==a.msg)return;10<this._errors.length&&this.send(this._EVENTS.HEARTBEAT);this._errors.push(a);this.log(a,"Add Error")},_getEvent:function(){var a=document.referrer,b={url:location.href.replace(/#.+$/,""),title:document.title,referer:document.referrer};this.isInDomain(a)&&(a=this.getCookie("ak_e"))&&(b.fei=a);this._tags&&(b.tags=this._tags);
a=this.getTime();this._start&&(b.clt=a-(this._start instanceof Date?this._start.getTime():this._start));this._slt&&(b.slt=this._slt);"undefined"!==typeof performance&&(performance.timing&&(b.lt=a-performance.timing.navigationStart,b.clt=a-performance.timing.responseStart),performance.memory&&(b.mem=Math.floor(performance.memory.totalJSHeapSize/1E3)));(a=this.getCookie(this._cfs.uidKey||"ak_u"))&&(b.ui=a);(a=this.getCookie(this._cfs.sidKey||"any123_ut"))&&(b.asi=a);return b},_getClient:function(){return{screen:screen.width+
"x"+screen.height,colorDepth:screen.colorDepth,agent:navigator.userAgent,lang:navigator.language}},_getSession:function(){return{}},send:function(a,b){var c={t:a};this._sessionId||(this._sessionId=this._cfs.sessionId,this._sessionId||(this._sessionId=this.getCookie("ak_s"),this._sessionId||(this._sessionId=this.uuid(),this.log(this._sessionId,"Create new sessionId"),c.session=this._getSession()),this.setDomainCookie("ak_s",this._sessionId,this._cfs.sTimeout||1800,"/")));c.si=this._sessionId;this._clientId||
(this._cfs.tracked?this._clientId=this._cfs.clientId:(this._clientId=this.getCookie("ak_c"),this._clientId||(this._clientId=this._cfs.clientId,this._clientId||(this._clientId=this._sessionId,this.log(this._clientId,"Create new clientId")),this.setDomainCookie("ak_c",this._clientId,3E8,"/")),c.client=this._getClient()));switch(a){case this._EVENTS.BEGIN:c.ci=this._clientId;break;case this._EVENTS.END:var e=this._updateIdle(!0);e&&(c.idle=e)}this._eventId||(this._eventId=this.uuid(),this.log(this._eventId,
"Create new eventId"),c.e=this._getEvent());c.ei=this._eventId;var e=!1,d;for(d in this._customs)this._customs.hasOwnProperty(d)&&(e=!0);e&&(c.cs=this._customs,this._customs={});this._errors.length&&(c.es=this._errors,this._errors=[]);var g=this.getTime();this._actions.length&&(o(this._actions,function(){this.s&&(this.s=Math.floor((g-this.s)/1E3))}),c.as=this._actions,this._actions=[]);var f=this,c=JSON.stringify(c);this.log(c,"Send track data");b?this._post(this._cfs.url+"/track/"+this._cfs.appId+
"?s\x3d"+g,c,function(){f._lastSend=f.getTime();f.log("Post complete")}):this._get(this._cfs.url+"/track/"+this._cfs.appId+"?d\x3d"+encodeURIComponent(c)+"\x26s\x3d"+g,function(a){"onload"==a&&(f._lastSend=f.getTime());f.log("Get complete")})},_get:function(a,b){var c=new Image,e="atk_"+this.uuid(5);window[e]=c;var d=function(d){c.onload=c.onerror=c.onabort=null;c=window[e]=null;b&&b(d,a)};c.onload=function(){d("onload")};c.onerror=function(){d("onerror")};c.onabort=function(){d("onabort")};this.log(a.length,
"Track data length");c.src=a},_post:function(a,b,c){if(!this._form){var e=document,d=e.createElement("div");d.innerHTML='\x3cform id\x3d"_ak_form" method\x3d"post" target\x3d"_ak_iframe"\x3e\x3cinput type\x3d"hidden" name\x3d"d"/\x3e\x3c/form\x3e\x3ciframe id\x3d"_ak_iframe" src\x3d"about:blank"\x3e\x3c/iframe\x3e';e.body.appendChild(d);d.style.height="0px";d.style.width="0px";d.style.overflow="hidden";this._form=e.getElementById("_ak_form");this._iframe=e.getElementById("_ak_iframe")}var g=this;
this._iframe.onload=function(){"about:blank"!=g._iframe.src&&(g._iframe.src="about:blank",c&&c(b))};this._form.action=a;this._form.d.value=b;this._form.submit()},_onClick:function(a){this._lastActive=this.getTime();a=a||window.event;var b=a.srcElement?a.srcElement:a.target,c,e=this.getTime(),d={t:this._ACTIONS.CLICK};for(b.id&&(d.tid=b.id);"undefined"!==typeof b&&null!=b;){c=(b.tagName||b.nodeName||"").toUpperCase();if("A"==c)break;b=b.parentNode}b&&(d.url=b.href,d.t=this.isInDomain(d.url)?this._ACTIONS.INNNER_CLICK:
this._ACTIONS.OUTER_CLICK);b=Math.max(document.documentElement.scrollWidth,document.body.offsetWidth,document.body.clientWidth);c=Math.max(document.documentElement.scrollHeight,document.body.offsetHeight,document.body.clientHeight);var g,f;this._BROWSER.msie?(g=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),f=Math.max(document.documentElement.scrollTop,document.body.scrollTop),g=a.clientX+g,f=a.clientY+f):(g=a.pageX,f=a.pageY);if((!this._lastCAdd||!(1E3>e-this._lastCAdd||15>
Math.abs(this._lastCLeft-g)&&15>Math.abs(this._lastCTop-f)))&&0<g&&0<f&&g<=b&&f<=c)d.pos=g+","+f+","+b,this.trackAction(d),this._updateEventId(),this._lastCLeft=g,this._lastCTop=f,this._lastCAdd=this.getTime()},_onBlur:function(a){a=a||window.event;a=a.srcElement?a.srcElement:a.target;var b=a.value,c={t:this._ACTIONS.INPUT};b&&b!=this._lastBValue&&(c.v=100<b.length?b.substring(0,100):b,c.tid=a.id?a.id:a.name,this.trackAction(c),this._lastBValue=b)},_updateIdle:function(a){var b=this.getTime(),c=b-
this._lastActive;1E4<c&&(this._idle+=Math.round(c/1E3),this.log("Total idle "+this._idle+" Seconds"));if(a)return this._idle;5E3<c&&(this._lastActive=b);this._lowSpeed&&this.startHeartbeat()},_updateEventId:function(){this.getCookie("ak_e")!=this._eventId&&this.setDomainCookie("ak_e",this._eventId,null,"/")},startHeartbeat:function(a){var b=this;this._hbt&&this.stopHeartbeat();this._hbt=setInterval(function(){b.log("Do heartbeat");b.send(b._EVENTS.HEARTBEAT);3E5<b.getTime()-b._lastActive&&(b.log("Idle 5 minutes,use low speed heartbeat"),
b.startHeartbeat(!0))},a?3E5:3E4);this._lowSpeed=a;b.log("Start "+(a?"low":"normal")+" speed heartbeat")},stopHeartbeat:function(){clearInterval(this._hbt);this._hbt=null},init:function(){this._cmds=_atk||[];var a=this;u(function(){a._init()});return this},push:function(a){1<arguments.length&&(a=arguments);if(a&&a.length){var b=a[1];switch(a[0]){case "start":this._start=b;break;case "slt":this._slt=b;break;case "cfs":r(this._cfs,b,null,!0);this.log(this._cfs,"Use app configs");break;case "tags":this._tags=
Array.prototype.slice.call(a,1);break;case "customs":this.trackCustoms(b);break;case "action":for(b=1;b<a.length;b++){var c=a[b];void 0==c.t&&(c.t=this._ACTIONS.CUSTOM);this.trackAction(c)}break;case "actionCallback":this._actionCallbacks=this._actionCallbacks||[];this._actionCallbacks.push(b);break;case "ajax":this.trackAjax(b);break;case "ex":this.trackEx(b);break;case "send":this.send(this._EVENTS.HEARTBEAT);break;case "post":this.send(this._EVENTS.HEARTBEAT,!0)}}},_hookJquery:function(){var a=
this;jQuery.ajaxSetup({global:!0});jQuery(document).ajaxSend(function(b,c,e){e._ts=a.getTime()}).ajaxSuccess(function(b,c,e){a.trackAjax({url:e.url,ok:!0,lt:a.getTime()-e._ts})}).ajaxError(function(b,c,e){a.trackAjax({url:e.url,ok:!1,lt:a.getTime()-e._ts})})},_init:function(){var a=this;o(this._cmds,function(){a.push(this)});delete this._cmds;window.onerror=function(b,e,d){a.trackEx(b+"@"+e+":"+d)};this.bindEvent(window,"beforeunload",function(){a._updateEventId();a.send(a._EVENTS.END)});this.bindEvent(document,
"mousemove",function(){a._updateIdle()});!1==this._cfs.trackClick||"false"==this._cfs.trackClick||this.bindEvent(document,"mousedown",function(b){a._onClick(b)});if(!(!1==this._cfs.trackInput||"false"==this._cfs.trackInput)){var b=function(b){a._onBlur(b)};o(document.getElementsByTagName("input"),function(){a.bindEvent(this,"blur",b)});o(document.getElementsByTagName("textarea"),function(){a.bindEvent(this,"blur",b)})}!(!1==this._cfs.trackAjax||"false"==this._cfs.trackAjax)&&"undefined"!==typeof jQuery&&
this._hookJquery();this._idle=0;this._lastActive=this.getTime();this.send(this._EVENTS.BEGIN);this.startHeartbeat()}}}})();